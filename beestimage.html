<html ng-app="driveApp">
<head>
  <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="A simple element creator to generate responsive code that can be easily embbedded into Moodle">
    <meta name="author" content="T&M">
    <title>BEEST Image</title>
     <link rel="icon" href="img/dragon-solid-favicon.png" type="image/gif">
    <!-- external link to css file --> 
    <!-- Bootstrap CSS -->   
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <!-- Arts CSS -->  
    <link rel="stylesheet" href="css/adminPlusSetuBlockStyle.css" />
    <!-- external link to js file -->  
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="  https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script>
    <!-- Bootstrap js file --> 
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
    <!-- FontAwesome js file --> 
    <script src="https://kit.fontawesome.com/3817feae52.js"></script> 
    <!-- Tinymce js file -->   
    <script src='https://cloud.tinymce.com/stable/tinymce.min.js'></script>
    <script src="js/advancedModeLocalStorage.js"></script>
    <style>
        .mce-notification-inner, .mce-close, .mce-notification-warning {
        display:none !important;
        }
              /* Popup container - can be anything you want */
    #popup {
    position: relative;
    display: inline-block;
    cursor: pointer;
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none;
    }

    /* The actual popup */
    #popup .popuptext {
    visibility: hidden;
    width: 220px;
    background-color: #222222;
    color: #fff;
    text-align: center;
    border-radius: 6px;
    padding: 10px 5px;
    position: absolute;
    z-index: 1;
    bottom:100%;
    left: 50%;
    margin-left: -110px;
    }

    /* Popup arrow */
    #popup .popuptext::after {
    content: "";
    position: absolute;
    top: 100%;
    left: 50%;
    margin-left: -5px;
    border-width: 5px;
    border-style: solid;
    border-color: #555 transparent transparent transparent;
    }

    /* Toggle this class - hide and show the popup */
    #popup .showPopup {
    -webkit-animation: fadeinout 4s linear forwards;
    animation: fadeinout 4s linear forwards;
    visibility: visible;
    }

    /* Add animation (fade in the popup) */
    @-webkit-keyframes fadeinout {
      0%,100% { opacity: 0; }
      10% {opacity: 1;}
      66% { opacity: 1; }
    }

    @keyframes fadeinout {
      0%,100% { opacity: 0; }
      10% {opacity: 1;}
      66% { opacity: 1; }
    }
    .tooltip-inner {
      text-align: left;
      padding: 15px;
      font-size: 1.05rem;
      max-width: 480px;
    }

    </style>
    <script>
    window.gapiCallbacks=[];

    function gapiLoaded(){
      gapi.auth.init(function() {
        gapi.client.load('drive', 'v2').then(function () {
          var GapiQueue = function () {
            this.push = function (callback) {
              setTimeout(callback, 0);
            };
          };

          var _old_gapiCallbacks = window.gapiCallbacks;

          window.gapiCallbacks = new GapiQueue();

          _old_gapiCallbacks.forEach(function (callback) {
            window.gapiCallbacks.push(callback);
          });
        },function(reason){
          console.err(reason);
        });
      });
    }

    // The Browser API key obtained from the Google API Console.
    var developerKey = 'AIzaSyDc_XZvzDg7_zvLL_yZXG-hoa_2QA6MU6E';

    // The Client ID obtained from the Google API Console.
    var clientId = "97361103722-bs8u1e0lp7rnati4703leav6b4nknhg7.apps.googleusercontent.com"

    // See "Project number" under "IAM & Admin" > "Settings"
    var appId = "97361103722";

    // Scope to use to access user's Drive items.
    var scope = ['https://www.googleapis.com/auth/drive.file'];

    var pickerApiLoaded = false;
    var oauthToken;

    // Use the Google API Loader script to load the google.picker script.
    function loadPicker() {
      gapi.load('auth', {'callback': onAuthApiLoad});
      gapi.load('picker', {'callback': onPickerApiLoad});
    }
    
    // Load API key
    function onAuthApiLoad() {
      window.gapi.auth.authorize(
          {
            'client_id': clientId,
            'scope': scope,
            'immediate': false
          },
          handleAuthResult);
    }
    
    //Load Google Drive Picker
    function onPickerApiLoad() {
      pickerApiLoaded = true;
      createPicker();
    }

    function handleAuthResult(authResult) {
      if (authResult && !authResult.error) {
        oauthToken = authResult.access_token;
        createPicker();
      }
    }

    // Create and render a Picker object for searching images.
    function createPicker() {
      if (pickerApiLoaded && oauthToken) {
        var view = new google.picker.View(google.picker.ViewId.DOCS);
        view.setMimeTypes("image/png,image/jpeg,image/jpg");
        var picker = new google.picker.PickerBuilder()
            .enableFeature(google.picker.Feature.NAV_HIDDEN)
            .enableFeature(google.picker.Feature.MULTISELECT_ENABLED)
            .setAppId(appId)
            .setOAuthToken(oauthToken)
            .addView(view)
            .addView(new google.picker.DocsUploadView())
            .setDeveloperKey(developerKey)
            .setCallback(pickerCallback)
            .build();
         picker.setVisible(true);
      }
    }

    var imageplaceholder ="https://drive.google.com/uc?id=1Tel_KpnwCcoRUMdMFyw-GJ-_MaqeaWYZ&export=download";
    var url;
    url = imageplaceholder;

    // A simple callback implementation.
    function pickerCallback(data) {
      if (data.action == google.picker.Action.PICKED) {
        var fileId = data.docs[0].id;
        url = 'https://drive.google.com/uc?id=' + fileId + '&amp;export=download';
        document.getElementById('img').src = url;
        var imagepreview = document.getElementById("imagepreview");
        imagepreview.style.display = "block";
        //var imgpreview = document.getElementById("img2");
        //imgpreview.style.display = "none";
        generateCode();
      }
    }
    
    function writeinMoodle() {
      var win = window.open("https://lms.monash.edu/course/modedit.php?add=label&type=&course=36985&section=2&return=0&sr=0");
      win.writeinTinyMCE = function () {
          win.alert("Starting magic...");
          win.tinyMCE.get('#id_introeditor').setContent("<p>test</p>");
        }
      win.writeinTinyMCE();
      setTimeout(function () {
        win.document.body.appendChild(element);
        console.log('New script appended!')
    }, 10000);
    }

    tinymce.init({
        selector: '#tinyMCEimage',
        menubar: false,
        plugins : 'advlist autolink link lists charmap print preview code',
        toolbar: 'undo redo | styleselect | bold italic | alignleft aligncenter alignright alignjustify | outdent indent | numlist bullist | autolink link |lists | charmap | code | removeformat',
        setup : function(ed) {      
        ed.on('change', function (e) {	
          generateCode();
          });					
        }
    });
    
        var head_3="<h3>"
        var endHead_3="</h3>"
        var head_4="<h4>"
        var endHead_4="</h4>"
        var head_5="<h5>"
        var endHead_5="</h5>"

        var respImg_1="<div class=\"row w-100\"><div class=\"col-lg\">"
        var respImg_2="</div><div class=\"col-lg\"><img class=\"img-fluid\" src=\""
        var respImg_2r="<img class=\"img-fluid\" src=\""
        var respImg_3="\"></div></div>"
        var respImg_3r="\"></div>"
        var respImg_4="<div class=\"col-lg mt-2\">"
        var respImg_5="</div></div>"
   	/*These different options have been absorbed into a javascript Object allowing a direct mapping and lookup of code to icon name*/
	
    function iconpreview() {
        var faIcon = document.getElementById('faCode').value;
        var iconNames = {
			      "1":"image",
            "2":"play",
            "3":"eye" 
        }

        var iconName = iconNames[faIcon];
	     	var faIconCode = "<i id=\"icon\" class=\"fa fa-"+iconName+"\"></i> ";
		
        if (faIcon == "noI"){
          faIconCode = "";
          if (document.getElementById("icon"))
           {
            var icon = document.getElementById("icon");
            icon.parentNode.removeChild(icon);
            var iconpreview = document.getElementById("iconpreview");
            iconpreview.style.display = "none";
           }
        }

        else{
          if (document.getElementById("icon"))
          {
            var icon = document.getElementById("icon");
            icon.parentNode.removeChild(icon);
          }

          var code = document.createElement("span");
          code.innerHTML = faIconCode;
          var iconpreview = document.getElementById("iconpreview");
          iconpreview.style.display = "block";
          iconpreview.parentNode.insertBefore(code,iconpreview.nextSibling);
        }
        generateCode();
      }

    var contextCode;

    /*Function to generate and copy code for the responsive image*/
    function generateCode() {
        // Get the HTML contents of the currently active editor
        console.debug(tinyMCE.activeEditor.getContent());

        if (document.getElementById('respImgSwitch').value !== ""){
        url = document.getElementById('respImgSwitch').value;
        }

        //Retrieve the content by id of the tinyMCE textarea
        if (tinyMCE.get('tinyMCEimage').getContent() !== ""){
        contextCode = tinyMCE.get('tinyMCEimage').getContent();
        }
        else{
        contextCode = "[Placeholder for image context. The content you entered in step 2 will appear here.]";
        }

        var imgHeading = document.getElementById('respImgHeading').value;
        
        var imgPosition = document.getElementById('imagePosition').value;
        var headSize = document.getElementById('headSize').value;
        var faIcon = document.getElementById('faCode').value;
        var iconNames = {
			      "1":"image",
            "2":"play",
            "3":"eye" 
        }

        var iconName = iconNames[faIcon];
	     	var faIconCode = "<i class=\"fa fa-"+iconName+"\"></i> ";
		
        if (faIcon == "noI"){
          faIconCode = "";
        }
		
		var resizedHead;
        //Resizing the heading text
		switch(headSize){
			case "noH":
				resizedHead = "";
				break;
			case "h3":
				resizedHead = head_3+faIconCode+imgHeading+endHead_3;
				break;
			case "h4":
				resizedHead = head_4+faIconCode+imgHeading+endHead_4;
				break;
			case "h5":
				resizedHead = head_5+faIconCode+imgHeading+endHead_5;
				break;
		}

          if (url !== imageplaceholder)
          {
          }
          else
          {
            url = imageplaceholder;
          }

        if (imgPosition == "left"){
            var textOutput = resizedHead+respImg_1+respImg_2r+url+respImg_3r+respImg_4+contextCode+respImg_5;
        }
        else if (imgPosition == "right"){
            var textOutput = resizedHead+respImg_1+contextCode+respImg_2+url+respImg_3;
        }

        document.getElementById('txtarearespImg').innerHTML=textOutput;
        //SelectAll("txtarearespImg");
         //Add the html code after the div
		    var demoDiv = document.getElementById("demo");
		    demoDiv.innerHTML = textOutput;
        }

      var textarea = $('#respImgHeading');
      var select = $('#headSize');
      var addOrRemoveRequiredAttribute = function () {
      if (textarea.val().length) {
        select.val("h5")
      }
      };

      // Run now
      addOrRemoveRequiredAttribute();

      // And when textarea changes
      textarea.on('change', addOrRemoveRequiredAttribute);

    function SelectAll(id){
        document.getElementById(id).focus();
        document.getElementById(id).select();
        document.execCommand("copy");
        var popup = document.getElementById("myPopup");
        popup.classList.toggle("showPopup");
    }
 

    function submitform()
    {
        document.forms["myform"].submit();
    }
    $(function () {
  $('[data-toggle="tooltip"]').tooltip()
})

  </script>
  <!-- Load the Google API Loader script. -->
  <script type="text/javascript" src="https://apis.google.com/js/api.js?onload=onApiLoad"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.15/angular.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.10.2/moment.min.js"></script>

  <script src="js/drive-controller.js"></script>
  <script src="js/gapi-auth-service.js"></script>
  <script src="js/drive-service.js"></script>
  <script>   
    window.onload=function(){
      $('#beestNav').load('common/beestnav.html');
      $('#beestFooter').load('common/beestfooter.html');
      function activeNav() {
        var pgurl = window.location.href.substr(window.location.href.lastIndexOf("/")+1);
         $(".nav-link").each(function(){
              if($(this).attr("href") == pgurl || $(this).attr("href") == '' )
              $(this).addClass("active");
              $(this).append('<span class="sr-only">(current)</span>')
         });
    }
    
    setTimeout(function() {
        activeNav();
    }, 100);

  };

  </script>

</head>
<body onload="generateCode()">
  <nav class="navbar navbar-expand-lg navbar-dark bg-arts mb-3">

    <a class="navbar-brand text-center border border-white p-2 rounded" href="index.html"><img src="img/dragon-solid-white.png" width="30" height="30" alt=""></a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavDropdown" aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNavDropdown">
      <ul class="navbar-nav">
        <li class="nav-item active">
          <a class="nav-link" href="index.html">Home <span class="sr-only">(current)</span></a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="beestvideo.html">Video</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="beestimage.html">Image</a>
        </li>
        <li class="nav-item">
        <a class="nav-link" href="beestbutton.html">Button</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="beestalert.html">Alert</a>
        </li>
           <li class="nav-item">
          <a class="nav-link" href="beestpollev.html">Poll Everywhere</a>
        </li>
           <li class="nav-item">
          <a class="nav-link" href="beestreadmore.html">Read More Button</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="beestaccordion.html">Accordion</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="beestquote.html">Quote</a>
        </li>
      </ul>
    </div>
  </nav>

<h1 class="text-center"><i class="fa fa-image"></i> Responsive image + context</h1>

<form id="respImg">   
   <div class="row w-100 mx-auto">
    <div class="col-lg-8 mt-2">
    <div class="row w-100 mx-auto">
        <h5 class="w-50" data-toggle="tooltip" data-placement="right" data-trigger="hover focus" title="Paste in the link/URL (not the embed code) for your video. When you paste the link into this box it will automatically change the link to be the embed link required for the platform you are pasting from this process to work and you will not be able to edit this box.">Step 1 - Image link</h5>
        <div class="row w-100 mx-auto">
        <p>Please find your image from <a href="https://unsplash.com">https://unsplash.com</a> and paste the URL here</p>
        <textarea class="rounded p-2 w-100" rows="1" name="respImgSwitch" type="text" id="respImgSwitch" placeholder="Paste the Unsplash image link here" onchange=generateCode()></textarea>
        </div>
        <div ng-controller="driveController">        
          <!--<div ng-show="checkingLogin">Checking login status...</div>
          Login status:{{loggedIn}}
          <button ng-disabled="checkingLogin || loggedIn" ng-click="login()">Log In</button>-->
        
          <div ng-show="loggedIn">
            <input ng-disabled="uploading" ng-click="clickFileUpload()" type="button" class="btn btn-arts m-1" name="uploadImage" value="Upload image" >
            <!--<button ng-disabled="uploading" ng-click="clickFileUpload()">Upload image</button>-->
            <input type="button" class="btn btn-arts m-1" name="uploadImage" value="Choose Image from Google Drive" onclick="loadPicker()">
            <!--<button onclick="loadPicker()">Choose Image from Google Drive</button>-->
            <input type="file" id="uploadImage" accept="image/*" onchange="angular.element(this).scope().upload()" style="display:none;">
            <div ng-show="uploading">Uploading image to your Google Drive ...</div>    
            <!--<div ng-show="!images.length">No uploaded images yet</div>-->
            <div ng-repeat="image in images" style="max-width:800px;max-height:800px;">
              <img id ="img2" ng-src="{{image}}" style="max-width: 100%;max-height: 100%;">
            </div>
          </div>

    <div class="row w-100 mx-auto">
        <h5 class="w-50" data-toggle="tooltip" data-placement="right" data-trigger="hover focus" title="It's recommended to have a few sentences or dot points explaining what is in the video students are about to watch. This helps in particular when students are looking back through your site for a specific video where you addressed certain concepts or theories. Instead of watching the entire video, they can read the context you have provided, and decide if they have found what they need without having to watch the entire video.">Step 2 - Image context</h5>
            <textarea id="tinyMCEimage" class="border border-dark rounded p-2 w-100" cols="70" rows="5" name="respVid_context"></textarea>
    </div>
   </div>

      <div class="col-lg-3">
        <h5 id="imagepreview" class="w-50" data-toggle="tooltip" data-placement="right" data-trigger="hover focus" style="display:none;">Image Preview</h5>
        <img id="img" src="" style="max-width:100%;max-height:100%;">
      </div> 
    </div>
  </div>
    
   
      <div class="row w-100 mx-auto">
        <div class="col-lg-8 mt-2">
          <h5 class="w-50" data-toggle="tooltip" data-placement="right" data-trigger="hover focus" title="Choose which half/side of screen you would prefer the video to appear by clicking on one of the options below. Video on the left is selected by default.">Step 3 - Image position</h5>
                <select class="custom-select w-50 border border-dark" id="imagePosition" name="imagePosition" size="1" onchange=generateCode()>
                <option value="left" selected>Image on the left</option>
                <option value="right">Image on the right</option>
              </select>
              </div> 
            </div> 
            <div class="row w-100 mx-auto">
              <div class="col-lg-8 mt-2">
                <h5 class="w-50" data-toggle="tooltip" data-placement="right" data-trigger="hover focus" title="Type the heading for this video. 50 character maximum. If you want a heading, you must also complete step 5 or your heading will not display.">Step 4 - Heading (optional)</h5>
                <textarea maxlength="50" class="rounded p-2 w-100" rows="1" name="respVid_heading" type="text" id="respImgHeading" placeholder="Type your image heading here" onchange=generateCode()></textarea>
              </div>
            </div>

    <div class="row w-100 mx-auto">
    <div class="col-lg-8 mt-2">
      <h5 class="w-50" data-toggle="tooltip" data-placement="right" data-trigger="hover focus" title="Choose the size of your heading. No heading is chosen by default. If you do not choose a heading size, your heading will not display.">Step 5 - Heading size (optional)</h5>
            <select class="custom-select w-50 border border-dark" id="headSize" name="headSize" size="1" onchange=generateCode()>
            <!--<option selected value="noH">No heading</option>-->
            <option selected value="h5">Small</option>
            <option value="h4">Medium</option>
            <option value="h3">Large</option>
          </select>
          </div> 
        </div>   
        <div class="row w-100 mx-auto">
          <div class="col-lg-5">
            <h5 class="w-50" data-toggle="tooltip" data-placement="right" data-trigger="hover focus" title="Choose an icon to go with your heading. No icon is selected by default. If you want an icon, you must also write a heading (step 4) and choose a heading size (step 5) and or the icon and heading will not display.">Step 6 - Select icon (optional)</h5>
            <select class="custom-select w-50 border border-dark" id="faCode" name="faCode" size="1" onchange=generateCode()>
              <option selected value="noI">No icon</option>
                <option value="1">Image</option>
                <option value="2">Play</option>
                <option value="3">Eye</option>
              </select>
            </div>

            <div class="col-lg-2" >
            <h5 id="iconpreview" class="w-50" data-toggle="tooltip" data-placement="right" data-trigger="hover focus" style="display:none;">Icon Preview</h5>
            </div>
          </div> 

    <div class="row w-100 mx-auto">
    <div class="col-lg-8 mt-2">
        <h5 class="w-50" data-toggle="tooltip" data-placement="right" data-trigger="focus hover" title="Click this button to generate and copy the code for your element ready for pasting in Moodle. A preview of the element will appear under Step 8.">Step 7 - Copy code and paste them into Moodle</h5>
        <p id="popup"> <span class="popuptext" id="myPopup">Your code has been copied</span><input type="button" class="btn btn-arts m-1" name="GenerateWrap" value="Copy your code" onClick=generateCode() ></p>
        <textarea readonly class="rounded p-2 w-100" id="txtarearespImg" cols="70" rows="3" name="Result" placeholder="Code for your element will appear here"></textarea>
        
        <!--<input type="button" class="btn btn-arts m-1" name="GenerateWrap" value="Write back to Moodle" onClick=writeinMoodle() >-->
    
      </div>
    </div>
              <div class="row w-100 mb-3 mx-auto">
                <div class="col-lg mt-2">
                <h5 style="width:33.33%;" data-toggle="tooltip" data-placement="right" data-trigger="hover focus" title="A preview of your element will appear below when you click the generate code button in Step 7.">Step 7 - Preview</h5>
                </div>
              </div>
    </form>

    <div id="demo">                     
    </div>
    <p class="my-3"></p>
  </div>

<script src="https://apis.google.com/js/client.js?onload=gapiLoaded"></script>
<script type="text/javascript" src="https://apis.google.com/js/api.js"></script>

<script>
    $('#respImgSwitch').on('input', function(event) {
    var s = $('#respImgSwitch').val().toString();
    
    if (s.includes("unsplash.com") == true) {
    //code for converting Vimeo link from Viewer to Embed
    var x = s.replace('https://unsplash.com/photos','https://source.unsplash.com');
    }

    $('#respImgSwitch').val(x);
    //$('input[type="text"], textarea#respVidSwitch').attr('readonly','readonly');
  }); 
  var textarea = $('#respImgHeading');
  var select = $('#headSize');
  var addOrRemoveRequiredAttribute = function () {
  if (textarea.val().length) {
    select.val("h5")
  }
  };

  // Run now
  addOrRemoveRequiredAttribute();

  // And when textarea changes
  textarea.on('change', addOrRemoveRequiredAttribute);
</script>

<div id="beestFooter"></div>
</body>
</html>