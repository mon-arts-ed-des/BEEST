<html ng-app="driveApp">
<head>
  <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="A simple element creator to generate responsive code that can be easily embbedded into Moodle">
    <meta name="author" content="T&M">
    <title>BEEST Video</title>
     <link rel="icon" href="https://mon-arts-ed-des.github.io/BEEST/dragon-solid%20favicon.png" type="image/gif">
    <!-- external link to css file --> 
    <!-- Bootstrap CSS -->   
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <!-- Arts CSS -->  
    <link rel="stylesheet" href="https://mon-arts-ed-des.github.io/artsmoodlecode/adminPlusSetuBlockStyle.css" />
    <!-- external link to js file -->  
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="  https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script>
    <!-- Bootstrap js file --> 
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
    <!-- FontAwesome js file --> 
    <script src="https://kit.fontawesome.com/3817feae52.js"></script> 
    <!-- Tinymce js file -->   
    <script src='https://cloud.tinymce.com/stable/tinymce.min.js'></script>
    <script src="advancedModeLocalStorage.js"></script>
  <script>
    window.gapiCallbacks=[];

    function gapiLoaded(){
      gapi.auth.init(function() {
        gapi.client.load('drive', 'v2').then(function () {
          var GapiQueue = function () {
            this.push = function (callback) {
              setTimeout(callback, 0);
            };
          };

          var _old_gapiCallbacks = window.gapiCallbacks;

          window.gapiCallbacks = new GapiQueue();

          _old_gapiCallbacks.forEach(function (callback) {
            window.gapiCallbacks.push(callback);
          });
        },function(reason){
          console.err(reason);
        });
      });
    }

    // The Browser API key obtained from the Google API Console.
    // Replace with your own Browser API key, or your own key.
    var developerKey = 'AIzaSyDc_XZvzDg7_zvLL_yZXG-hoa_2QA6MU6E';

    // The Client ID obtained from the Google API Console. Replace with your own Client ID.
    var clientId = "97361103722-bs8u1e0lp7rnati4703leav6b4nknhg7.apps.googleusercontent.com"

    // Replace with your own project number from console.developers.google.com.
    // See "Project number" under "IAM & Admin" > "Settings"
    var appId = "97361103722";

    // Scope to use to access user's Drive items.
    var scope = ['https://www.googleapis.com/auth/drive.file'];

    var pickerApiLoaded = false;
    var oauthToken;

    // Use the Google API Loader script to load the google.picker script.
    function loadPicker() {
      gapi.load('auth', {'callback': onAuthApiLoad});
      gapi.load('picker', {'callback': onPickerApiLoad});
    }

    function onAuthApiLoad() {
      window.gapi.auth.authorize(
          {
            'client_id': clientId,
            'scope': scope,
            'immediate': false
          },
          handleAuthResult);
    }

    function onPickerApiLoad() {
      pickerApiLoaded = true;
      createPicker();
    }

    function handleAuthResult(authResult) {
      if (authResult && !authResult.error) {
        oauthToken = authResult.access_token;
        createPicker();
      }
    }

    // Create and render a Picker object for searching images.
    function createPicker() {
      if (pickerApiLoaded && oauthToken) {
        var view = new google.picker.View(google.picker.ViewId.DOCS);
        view.setMimeTypes("image/png,image/jpeg,image/jpg");
        var picker = new google.picker.PickerBuilder()
            .enableFeature(google.picker.Feature.NAV_HIDDEN)
            .enableFeature(google.picker.Feature.MULTISELECT_ENABLED)
            .setAppId(appId)
            .setOAuthToken(oauthToken)
            .addView(view)
            .addView(new google.picker.DocsUploadView())
            .setDeveloperKey(developerKey)
            .setCallback(pickerCallback)
            .build();
         picker.setVisible(true);
      }
    }

    // A simple callback implementation.
    function pickerCallback(data) {
      if (data.action == google.picker.Action.PICKED) {
        var fileId = data.docs[0].id;
        var url = 'https://drive.google.com/uc?id=' + fileId + '&amp;export=download';
        //alert('the selected file id is: ' + fileId + ' and I am still fixing some bugs');
        document.getElementById('img').src = url;
      }
    }

  </script>
  <!-- Load the Google API Loader script. -->
  <script type="text/javascript" src="https://apis.google.com/js/api.js?onload=onApiLoad"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.15/angular.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.10.2/moment.min.js"></script>

  <script src="drive-controller.js"></script>
  <script src="gapi-auth-service.js"></script>
  <script src="drive-service.js"></script>

</head>
<body>
  <nav class="navbar navbar-expand-lg navbar-dark bg-arts mb-3">
    <a class="navbar-brand text-center border border-white p-2 rounded" href="index.html"><img src="dragon-solid-white.png" width="30" height="30" alt=""></a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavDropdown" aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNavDropdown">
      <ul class="navbar-nav">
        <li class="nav-item active">
          <a class="nav-link" href="index.html">Home <span class="sr-only">(current)</span></a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="beestvideo.html">Responsive Video</a>
        </li>
        <li class="nav-item">
        <a class="nav-link" href="beestbuttons.html">Buttons</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="beestalerts.html">Alerts</a>
        </li>
           <li class="nav-item">
          <a class="nav-link" href="beestpollev.html">Poll Everywhere</a>
        </li>
           <li class="nav-item">
          <a class="nav-link" href="beestreadmore.html">Read More Button</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="beestacc.html">Accordion</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="beestquote.html">Quote</a>
        </li>
      </ul>
    </div>
  </nav>
<div ng-controller="driveController">
  <div ng-show="checkingLogin">Checking login status...</div>
  Login status:{{loggedIn}}
  <button ng-disabled="checkingLogin || loggedIn" ng-click="login()">Log In</button>
  <div ng-show="loggedIn">
    <h2>Google Drive</h2>
    <button ng-disabled="uploading" ng-click="clickFileUpload()">Upload image</button>
    <button onclick="loadPicker()">Choose Image from Google Drive</button>
    <input type="file" id="uploadImage" accept="image/*" onchange="angular.element(this).scope().upload()" style="display:none;">
    <div ng-show="uploading">Uploading image to your Google Drive ...</div>

    <h3>Images:</h3>
    <!--<div ng-show="!images.length">No uploaded images yet</div>-->
    <img id="img" src="" style="max-width:800px;max-height:800px;">
    <div ng-repeat="image in images" style="max-width:800px;max-height:800px;">
      <img ng-src="{{image}}" style="max-width: 100%;max-height: 100%;">
    </div>
  </div>
</div>

<script src="https://apis.google.com/js/client.js?onload=gapiLoaded"></script>
<script type="text/javascript" src="https://apis.google.com/js/api.js"></script>
</body>
</html>